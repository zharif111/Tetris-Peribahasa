<!doctype html>
<html lang="ms">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Tetris Peribahasa</title>
  <script src="/_sdk/data_sdk.js"></script>
  <script src="/_sdk/element_sdk.js"></script>
  <style>
    body {
      box-sizing: border-box;
      margin: 0;
      padding: 20px;
      font-family: 'Courier New', monospace;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: #fff;
      min-height: 100%;
      overflow-x: hidden;
    }

    .retro-bg {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      opacity: 0.1;
      pointer-events: none;
      z-index: 0;
      background-image: 
        repeating-linear-gradient(0deg, transparent, transparent 2px, #fff 2px, #fff 4px),
        repeating-linear-gradient(90deg, transparent, transparent 2px, #fff 2px, #fff 4px);
    }

    .container {
      position: relative;
      z-index: 1;
      max-width: 1200px;
      margin: 0 auto;
    }

    .game-title {
      text-align: center;
      font-size: 48px;
      font-weight: bold;
      text-shadow: 4px 4px 0 #000, -2px -2px 0 #ff00ff, 2px 2px 0 #00ffff;
      margin-bottom: 30px;
      animation: pulse 2s infinite;
    }

    @keyframes pulse {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.05); }
    }

    .screen {
      display: none;
      animation: fadeIn 0.3s;
    }

    .screen.active {
      display: block;
    }

    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }

    .start-screen {
      background: rgba(0, 0, 0, 0.8);
      border: 4px solid #ffff00;
      border-radius: 20px;
      padding: 40px;
      text-align: center;
      box-shadow: 0 0 30px rgba(255, 255, 0, 0.5);
    }

    .welcome-text {
      font-size: 24px;
      margin-bottom: 30px;
      color: #00ffff;
    }

    .name-input {
      width: 100%;
      max-width: 300px;
      padding: 15px;
      font-size: 18px;
      border: 3px solid #ff00ff;
      border-radius: 10px;
      background: #000;
      color: #fff;
      font-family: 'Courier New', monospace;
      margin-bottom: 20px;
      text-align: center;
    }

    .btn {
      padding: 15px 40px;
      font-size: 20px;
      font-weight: bold;
      border: 3px solid;
      border-radius: 10px;
      cursor: pointer;
      font-family: 'Courier New', monospace;
      transition: all 0.3s;
      margin: 10px;
      text-transform: uppercase;
    }

    .btn-start {
      background: #00ff00;
      color: #000;
      border-color: #00ff00;
    }

    .btn-start:hover {
      background: #00cc00;
      transform: scale(1.1);
    }

    .btn-menu {
      background: #ffff00;
      color: #000;
      border-color: #ffff00;
      padding: 10px 20px;
      font-size: 16px;
    }

    .btn-menu:hover {
      background: #cccc00;
    }

    .leaderboard {
      background: rgba(0, 0, 0, 0.8);
      border: 3px solid #ff00ff;
      border-radius: 15px;
      padding: 20px;
      margin: 20px 0;
      max-height: 300px;
      overflow-y: auto;
    }

    .leaderboard-title {
      font-size: 28px;
      color: #ffff00;
      text-align: center;
      margin-bottom: 15px;
      text-shadow: 2px 2px 0 #000;
    }

    .leaderboard-item {
      display: flex;
      justify-content: space-between;
      padding: 10px;
      margin: 5px 0;
      background: rgba(255, 255, 255, 0.1);
      border-radius: 5px;
      border-left: 4px solid #00ffff;
    }

    .leaderboard-item.top3 {
      border-left-color: #ffd700;
      background: rgba(255, 215, 0, 0.2);
    }

    .game-screen {
      display: flex;
      gap: 20px;
      justify-content: center;
      flex-wrap: wrap;
    }

    .game-panel {
      background: rgba(0, 0, 0, 0.8);
      border: 4px solid #00ffff;
      border-radius: 15px;
      padding: 20px;
    }

    .game-board {
      width: 300px;
      height: 600px;
      background: #000;
      border: 3px solid #ff00ff;
      position: relative;
      display: grid;
      grid-template-rows: repeat(20, 1fr);
      grid-template-columns: repeat(10, 1fr);
    }

    .cell {
      border: 1px solid rgba(255, 255, 255, 0.1);
    }

    .cell.filled {
      border: 1px solid rgba(0, 0, 0, 0.3);
    }

    .info-panel {
      width: 250px;
    }

    .info-box {
      background: rgba(255, 255, 255, 0.1);
      padding: 15px;
      border-radius: 10px;
      margin-bottom: 15px;
      border: 2px solid #00ff00;
    }

    .info-label {
      font-size: 14px;
      color: #ffff00;
      margin-bottom: 5px;
    }

    .info-value {
      font-size: 28px;
      font-weight: bold;
      color: #00ffff;
    }

    .timer {
      font-size: 36px;
      color: #ff0000;
      text-shadow: 2px 2px 0 #000;
    }

    .question-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.95);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 1000;
    }

    .question-overlay.active {
      display: flex;
    }

    .question-box {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      border: 4px solid #ffff00;
      border-radius: 20px;
      padding: 40px;
      max-width: 600px;
      width: 90%;
      box-shadow: 0 0 50px rgba(255, 255, 0, 0.5);
    }

    .question-text {
      font-size: 24px;
      margin-bottom: 30px;
      color: #fff;
      text-align: center;
    }

    .answer-btn {
      width: 100%;
      padding: 15px;
      margin: 10px 0;
      font-size: 18px;
      border: 3px solid #00ffff;
      border-radius: 10px;
      background: rgba(0, 0, 0, 0.5);
      color: #fff;
      cursor: pointer;
      transition: all 0.3s;
      font-family: 'Courier New', monospace;
      text-align: left;
    }

    .answer-btn:hover {
      background: rgba(0, 255, 255, 0.3);
      transform: translateX(10px);
    }

    .answer-btn.correct {
      background: #00ff00;
      color: #000;
      border-color: #00ff00;
    }

    .answer-btn.wrong {
      background: #ff0000;
      color: #fff;
      border-color: #ff0000;
    }

    .menu-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.95);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 1000;
    }

    .menu-overlay.active {
      display: flex;
    }

    .menu-box {
      background: rgba(0, 0, 0, 0.9);
      border: 4px solid #ff00ff;
      border-radius: 20px;
      padding: 30px;
      max-width: 500px;
      width: 90%;
    }

    .menu-title {
      font-size: 32px;
      color: #ffff00;
      text-align: center;
      margin-bottom: 20px;
    }

    .answered-questions {
      max-height: 300px;
      overflow-y: auto;
      margin: 20px 0;
    }

    .answered-item {
      padding: 10px;
      margin: 5px 0;
      background: rgba(255, 255, 255, 0.1);
      border-radius: 5px;
      border-left: 4px solid;
    }

    .answered-item.correct {
      border-left-color: #00ff00;
    }

    .answered-item.wrong {
      border-left-color: #ff0000;
    }

    .end-screen {
      background: rgba(0, 0, 0, 0.9);
      border: 4px solid #00ff00;
      border-radius: 20px;
      padding: 40px;
      text-align: center;
    }

    .final-score {
      font-size: 64px;
      color: #ffff00;
      margin: 20px 0;
      text-shadow: 3px 3px 0 #000;
    }

    .motivation-text {
      font-size: 24px;
      color: #00ffff;
      margin: 20px 0;
      font-style: italic;
    }

    .btn-replay {
      background: #ff00ff;
      color: #fff;
      border-color: #ff00ff;
    }

    .btn-replay:hover {
      background: #cc00cc;
      transform: scale(1.1);
    }

    .duck-container {
      position: fixed;
      bottom: -100px;
      width: 100%;
      height: 100%;
      pointer-events: none;
      z-index: 999;
    }

    .duck {
      position: absolute;
      width: 60px;
      height: 60px;
      animation: floatUp 4s ease-in-out forwards;
    }

    @keyframes floatUp {
      0% {
        transform: translateY(0) rotate(0deg);
        opacity: 1;
      }
      100% {
        transform: translateY(-120%) rotate(360deg);
        opacity: 0;
      }
    }

    .duck-celebrate {
      position: absolute;
      width: 100px;
      height: 100px;
      animation: waddle 2s ease-in-out infinite;
    }

    @keyframes waddle {
      0%, 100% {
        transform: translateX(0) rotate(-5deg);
      }
      25% {
        transform: translateX(10px) rotate(5deg);
      }
      50% {
        transform: translateX(0) rotate(-5deg);
      }
      75% {
        transform: translateX(-10px) rotate(5deg);
      }
    }

    .duck-corner {
      position: fixed;
      width: 50px;
      height: 50px;
      opacity: 0.6;
      z-index: 10;
      animation: bob 3s ease-in-out infinite;
    }

    @keyframes bob {
      0%, 100% { transform: translateY(0); }
      50% { transform: translateY(-15px); }
    }

    .duck-corner.top-left {
      top: 10px;
      left: 10px;
      animation-delay: 0s;
    }

    .duck-corner.top-right {
      top: 10px;
      right: 10px;
      animation-delay: 0.5s;
    }

    .duck-corner.bottom-left {
      bottom: 10px;
      left: 10px;
      animation-delay: 1s;
    }

    .duck-corner.bottom-right {
      bottom: 10px;
      right: 10px;
      animation-delay: 1.5s;
    }

    .duck-swim {
      position: absolute;
      width: 45px;
      height: 45px;
      animation: swim 10s linear infinite;
    }

    @keyframes swim {
      0% {
        left: -100px;
        transform: scaleX(1);
      }
      48% {
        left: calc(100% + 100px);
        transform: scaleX(1);
      }
      52% {
        left: calc(100% + 100px);
        transform: scaleX(-1);
      }
      100% {
        left: -100px;
        transform: scaleX(-1);
      }
    }

    .duck-bounce {
      position: absolute;
      width: 55px;
      height: 55px;
      animation: bounce 2.5s ease-in-out infinite;
    }

    @keyframes bounce {
      0%, 100% { 
        transform: translateY(0) scale(1);
      }
      50% { 
        transform: translateY(-25px) scale(1.05);
      }
    }

    .duck-spin {
      position: absolute;
      width: 40px;
      height: 40px;
      animation: spin 5s linear infinite;
    }

    @keyframes spin {
      from { transform: rotate(0deg); }
      to { transform: rotate(360deg); }
    }

    .duck-float {
      position: absolute;
      animation: float 4s ease-in-out infinite;
    }

    @keyframes float {
      0%, 100% { 
        transform: translateY(0) translateX(0);
      }
      25% { 
        transform: translateY(-10px) translateX(5px);
      }
      50% { 
        transform: translateY(0) translateX(10px);
      }
      75% { 
        transform: translateY(-10px) translateX(5px);
      }
    }

    .duck-shake {
      position: absolute;
      animation: shake 2s ease-in-out infinite;
    }

    @keyframes shake {
      0%, 100% { transform: rotate(0deg); }
      25% { transform: rotate(-8deg); }
      75% { transform: rotate(8deg); }
    }

    .duck-pulse {
      position: absolute;
      animation: duckPulse 2s ease-in-out infinite;
    }

    @keyframes duckPulse {
      0%, 100% { transform: scale(1); opacity: 0.7; }
      50% { transform: scale(1.15); opacity: 1; }
    }

    .duck-size-tiny {
      width: 30px;
      height: 30px;
    }

    .duck-size-small {
      width: 40px;
      height: 40px;
    }

    .duck-size-medium {
      width: 50px;
      height: 50px;
    }

    .duck-size-large {
      width: 65px;
      height: 65px;
    }

    .duck-header {
      display: inline-block;
      width: 45px;
      height: 45px;
      animation: wiggle 1.5s ease-in-out infinite;
      vertical-align: middle;
      margin: 0 15px;
      opacity: 0.8;
    }

    @keyframes wiggle {
      0%, 100% { transform: rotate(-8deg); }
      50% { transform: rotate(8deg); }
    }

    .cheerleader-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 1500;
      pointer-events: none;
    }

    .cheerleader-overlay.active {
      display: flex;
    }

    .cheerleader-duck {
      width: 200px;
      height: 200px;
      animation: cheerJump 0.6s ease-in-out 3;
      filter: drop-shadow(0 10px 20px rgba(0, 0, 0, 0.5));
    }

    @keyframes cheerJump {
      0%, 100% { 
        transform: translateY(0) scale(1) rotate(0deg);
      }
      25% {
        transform: translateY(-40px) scale(1.1) rotate(-5deg);
      }
      50% { 
        transform: translateY(-60px) scale(1.15) rotate(0deg);
      }
      75% {
        transform: translateY(-40px) scale(1.1) rotate(5deg);
      }
    }

    .confetti {
      position: absolute;
      width: 10px;
      height: 10px;
      background: #ffff00;
      animation: confettiFall 1.5s ease-out forwards;
    }

    @keyframes confettiFall {
      0% {
        transform: translateY(-100px) rotate(0deg);
        opacity: 1;
      }
      100% {
        transform: translateY(500px) rotate(720deg);
        opacity: 0;
      }
    }

    .decorative-ducks {
      position: absolute;
      width: 100%;
      height: 100%;
      pointer-events: none;
      overflow: hidden;
    }

    @media (max-width: 768px) {
      .game-title {
        font-size: 32px;
      }
      
      .game-board {
        width: 250px;
        height: 500px;
      }
      
      .info-panel {
        width: 100%;
      }
    }
  </style>
  <style>@view-transition { navigation: auto; }</style>
  <script src="https://cdn.tailwindcss.com" type="text/javascript"></script>
 </head>
 <body>
  <div class="retro-bg"></div>
  <div class="container">
   <h1 class="game-title" id="gameTitle"><span class="duck-header" style="animation-delay: 0s;"></span> TETRIS PERIBAHASA <span class="duck-header" style="animation-delay: 0.5s;"></span></h1><!-- Itik-itik sudut skrin -->
   <div class="duck-corner top-left"></div>
   <div class="duck-corner top-right"></div>
   <div class="duck-corner bottom-left"></div>
   <div class="duck-corner bottom-right"></div>
   <div id="startScreen" class="screen active">
    <div class="start-screen">
     <div class="decorative-ducks">
      <div class="duck-swim duck-size-small" style="top: 20%; animation-delay: 0s;"></div>
      <div class="duck-swim duck-size-small" style="top: 60%; animation-delay: 5s;"></div>
      <div class="duck-float duck-size-tiny" style="left: 8%; top: 10%;"></div>
      <div class="duck-float duck-size-tiny" style="right: 8%; top: 15%; animation-delay: 1s;"></div>
     </div>
     <div class="welcome-text" id="welcomeMessage">
      Selamat Datang! Jawab soalan peribahasa sambil bermain Tetris!
     </div><input type="text" id="playerName" class="name-input" placeholder="Masukkan nama anda" maxlength="20">
     <div class="leaderboard">
      <div class="leaderboard-title">
       üèÜ PAPAN PENDAHULU üèÜ
      </div>
      <div id="startLeaderboard"></div>
     </div><button class="btn btn-start" onclick="startGame()">MULA MAIN</button>
    </div>
   </div>
   <div id="gameScreen" class="screen">
    <div class="game-screen">
     <div class="game-panel">
      <div style="position: relative;">
       <div class="game-board" id="gameBoard"></div>
       <div class="duck-pulse duck-size-small" style="position: absolute; top: -35px; left: 50%; transform: translateX(-50%);"></div>
      </div>
     </div>
     <div class="info-panel">
      <div class="info-box">
       <div class="info-label">
        Pemain
       </div>
       <div class="info-value" id="currentPlayer">
        -
       </div>
      </div>
      <div class="info-box">
       <div class="info-label">
        Skor
       </div>
       <div class="info-value" id="currentScore">
        0
       </div>
      </div>
      <div class="info-box">
       <div class="info-label">
        Masa
       </div>
       <div class="info-value timer" id="timer">
        3:00
       </div>
      </div>
      <div class="info-box">
       <div class="info-label">
        Soalan Dijawab
       </div>
       <div class="info-value" id="questionsAnswered">
        0
       </div>
      </div>
      <div class="info-box" style="font-size: 12px; padding: 10px;">
       <div style="color: #ffff00; margin-bottom: 5px;">
        KAWALAN:
       </div>
       <div style="color: #00ffff;">
        ‚Üê ‚Üí : Gerak
       </div>
       <div style="color: #00ffff;">
        ‚Üì : Pecutan
       </div>
       <div style="color: #00ffff;">
        ‚Üë : Putar
       </div>
      </div><button class="btn btn-menu" onclick="toggleMenu()">MENU</button>
     </div>
    </div>
   </div>
   <div id="endScreen" class="screen">
    <div class="end-screen">
     <div style="position: relative;">
      <div class="duck-float duck-size-small" style="left: 5%; top: 5%;"></div>
      <div class="duck-float duck-size-small" style="right: 5%; top: 5%; animation-delay: 1.5s;"></div>
      <div class="duck-pulse duck-size-tiny" style="left: 15%; top: 50px; animation-delay: 0.5s;"></div>
      <div class="duck-pulse duck-size-tiny" style="right: 15%; top: 50px; animation-delay: 1s;"></div>
      <h2 style="font-size: 36px; color: #00ff00;">TAMAT PERMAINAN!</h2>
      <div class="final-score" id="finalScore">
       0
      </div>
      <div class="motivation-text" id="motivationText"></div>
      <div id="celebrateDucks" style="position: relative; height: 120px; margin: 20px 0;"></div>
     </div>
     <div class="leaderboard">
      <div class="leaderboard-title">
       üèÜ PAPAN PENDAHULU üèÜ
      </div>
      <div id="endLeaderboard"></div>
     </div><button class="btn btn-replay" onclick="replayGame()">MAIN LAGI</button>
    </div>
   </div>
  </div>
  <div id="questionOverlay" class="question-overlay">
   <div class="question-box">
    <div style="position: relative;">
     <div class="duck-shake duck-size-medium" style="left: -45px; top: 10px;"></div>
     <div class="duck-shake duck-size-medium" style="right: -45px; top: 10px; animation-delay: 0.5s;"></div>
     <div class="question-text" id="questionText"></div>
     <div id="answersContainer"></div>
    </div>
   </div>
  </div>
  <div id="menuOverlay" class="menu-overlay">
   <div class="menu-box">
    <div class="menu-title">
     MENU
    </div>
    <div class="answered-questions">
     <h3 style="color: #ffff00; text-align: center;">Soalan Yang Telah Dijawab</h3>
     <div id="answeredList"></div>
    </div><button class="btn btn-start" onclick="toggleMenu()">TERUSKAN</button> <button class="btn btn-replay" onclick="exitGame()">KELUAR</button>
   </div>
  </div>
  <div id="duckContainer" class="duck-container"></div>
  <div id="cheerleaderOverlay" class="cheerleader-overlay">
   <div class="cheerleader-duck" id="cheerleaderDuck"></div>
  </div>
  <script>
    const COLORS = ['#ff0000', '#00ff00', '#0000ff', '#ffff00', '#ff00ff', '#00ffff', '#ff8800'];
    const ROWS = 20;
    const COLS = 10;
    const GAME_DURATION = 180;

    const PERIBAHASA_QUESTIONS = [
      { q: "Bagai aur dengan _____", answers: ["tebing", "air", "sungai", "batu"], correct: 0 },
      { q: "Berat sama dipikul, ringan sama _____", answers: ["dijinjing", "dibawa", "diangkat", "dipegang"], correct: 0 },
      { q: "Seperti kacang lupakan _____", answers: ["kulitnya", "tanahnya", "airnya", "pohonnya"], correct: 0 },
      { q: "Air dicencang tidak akan _____", answers: ["putus", "habis", "hilang", "kering"], correct: 0 },
      { q: "Bagai _____ dengan bunga", answers: ["kumbang", "rama-rama", "lebah", "lalat"], correct: 0 },
      { q: "Sebab nila setitik, rosak _____ sebelanga", answers: ["susu", "air", "kuah", "kopi"], correct: 0 },
      { q: "Hangat-hangat tahi _____", answers: ["ayam", "itik", "kambing", "lembu"], correct: 0 },
      { q: "Tong kosong nyaring _____", answers: ["bunyinya", "suaranya", "ketukannya", "dentumnya"], correct: 0 },
      { q: "Seperti anjing dengan _____", answers: ["kucing", "tikus", "ayam", "kambing"], correct: 0 },
      { q: "Bagai pungguk merindukan _____", answers: ["bulan", "bintang", "matahari", "awan"], correct: 0 },
      { q: "Masuk bakul angkat _____", answers: ["sendiri", "bersama", "ramai-ramai", "bergilir"], correct: 0 },
      { q: "Biar lambat asal _____", answers: ["selamat", "sampai", "betul", "tepat"], correct: 0 },
      { q: "Lempar _____ sembunyi tangan", answers: ["batu", "kayu", "bola", "pasir"], correct: 0 },
      { q: "Bagai telur di hujung _____", answers: ["tanduk", "dahan", "pagar", "jalan"], correct: 0 },
      { q: "Berakit-rakit ke hulu, berenang-renang ke _____", answers: ["tepian", "pantai", "pulau", "laut"], correct: 0 }
    ];

    const MOTIVATION_MESSAGES = [
      "Hebat! Anda seorang pakar peribahasa! üåü",
      "Wow! Otak anda memang tajam! üß†",
      "Terbaik! Teruskan usaha cemerlang! üí™",
      "Fantastik! Guru pun kalah dengan anda! ÔøΩÔøΩÔøΩ",
      "Luar biasa! Anda memang juara! üèÜ",
      "Syabas! Skor yang mengagumkan! ‚≠ê",
      "Mantap! Jangan berhenti di sini! üöÄ",
      "Cemerlang! Anda semakin hebat! ‚ú®"
    ];

    let gameState = {
      board: [],
      currentPiece: null,
      currentX: 0,
      currentY: 0,
      score: 0,
      timeLeft: GAME_DURATION,
      playerName: '',
      usedQuestions: new Set(),
      answeredQuestions: [],
      isPaused: false,
      gameInterval: null,
      timerInterval: null
    };

    const defaultConfig = {
      game_title: "TETRIS PERIBAHASA",
      welcome_message: "Selamat Datang! Jawab soalan peribahasa sambil bermain Tetris!",
      background_color: "#667eea",
      surface_color: "#000000",
      text_color: "#ffffff",
      primary_action_color: "#00ff00",
      secondary_action_color: "#ffff00"
    };

    const dataHandler = {
      onDataChanged(data) {
        renderLeaderboard(data);
      }
    };

    async function init() {
      const initResult = await window.dataSdk.init(dataHandler);
      if (!initResult.isOk) {
        console.error("Failed to initialize data SDK");
      }
    }

    function createDuckSVG() {
      return `
        <svg viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
          <!-- Duck body -->
          <ellipse cx="50" cy="60" rx="25" ry="20" fill="#ffffff" stroke="#333" stroke-width="2"/>
          <!-- Duck head -->
          <circle cx="45" cy="40" r="15" fill="#ffffff" stroke="#333" stroke-width="2"/>
          <!-- Duck beak -->
          <ellipse cx="55" cy="42" rx="8" ry="5" fill="#ffa500" stroke="#333" stroke-width="1.5"/>
          <!-- Duck eye -->
          <circle cx="42" cy="38" r="3" fill="#000000"/>
          <!-- Duck wing -->
          <path d="M 55 55 Q 70 60 65 70" fill="none" stroke="#333" stroke-width="2" stroke-linecap="round"/>
          <!-- Duck tail -->
          <path d="M 30 65 Q 20 70 25 75" fill="#ffffff" stroke="#333" stroke-width="2"/>
        </svg>
      `;
    }

    function createCheerleaderDuckSVG() {
      return `
        <svg viewBox="0 0 150 150" xmlns="http://www.w3.org/2000/svg">
          <!-- Left Pompom -->
          <g id="leftPompom">
            <circle cx="20" cy="40" r="8" fill="#ff1493" opacity="0.9"/>
            <circle cx="15" cy="35" r="5" fill="#ff69b4" opacity="0.8"/>
            <circle cx="25" cy="35" r="5" fill="#ff69b4" opacity="0.8"/>
            <circle cx="15" cy="45" r="5" fill="#ff69b4" opacity="0.8"/>
            <circle cx="25" cy="45" r="5" fill="#ff69b4" opacity="0.8"/>
            <line x1="20" y1="48" x2="35" y2="60" stroke="#8b4513" stroke-width="2"/>
          </g>
          
          <!-- Right Pompom -->
          <g id="rightPompom">
            <circle cx="130" cy="40" r="8" fill="#ff1493" opacity="0.9"/>
            <circle cx="125" cy="35" r="5" fill="#ff69b4" opacity="0.8"/>
            <circle cx="135" cy="35" r="5" fill="#ff69b4" opacity="0.8"/>
            <circle cx="125" cy="45" r="5" fill="#ff69b4" opacity="0.8"/>
            <circle cx="135" cy="45" r="5" fill="#ff69b4" opacity="0.8"/>
            <line x1="130" y1="48" x2="115" y2="60" stroke="#8b4513" stroke-width="2"/>
          </g>
          
          <!-- Duck body -->
          <ellipse cx="75" cy="85" rx="30" ry="25" fill="#ffffff" stroke="#333" stroke-width="2.5"/>
          
          <!-- Duck head -->
          <circle cx="70" cy="60" r="18" fill="#ffffff" stroke="#333" stroke-width="2.5"/>
          
          <!-- Happy eye (closed in joy) -->
          <path d="M 62 58 Q 65 62 68 58" fill="none" stroke="#000000" stroke-width="2.5" stroke-linecap="round"/>
          
          <!-- Duck beak (open in cheer) -->
          <path d="M 82 60 Q 90 58 92 62 Q 90 66 82 64 Z" fill="#ffa500" stroke="#333" stroke-width="2"/>
          <line x1="82" y1="62" x2="88" y2="62" stroke="#333" stroke-width="1.5"/>
          
          <!-- Wings (raised up in celebration) -->
          <path d="M 50 75 Q 35 65 40 60" fill="none" stroke="#333" stroke-width="2.5" stroke-linecap="round"/>
          <path d="M 100 75 Q 115 65 110 60" fill="none" stroke="#333" stroke-width="2.5" stroke-linecap="round"/>
          
          <!-- Duck tail -->
          <path d="M 50 95 Q 40 100 45 105" fill="#ffffff" stroke="#333" stroke-width="2.5"/>
          
          <!-- Feet -->
          <ellipse cx="65" cy="112" rx="8" ry="4" fill="#ffa500" stroke="#333" stroke-width="1.5"/>
          <ellipse cx="85" cy="112" rx="8" ry="4" fill="#ffa500" stroke="#333" stroke-width="1.5"/>
          
          <!-- Sparkles around duck -->
          <circle cx="30" cy="50" r="2" fill="#ffff00" opacity="0.8">
            <animate attributeName="opacity" values="0.8;0.3;0.8" dur="1s" repeatCount="indefinite"/>
          </circle>
          <circle cx="120" cy="50" r="2" fill="#ffff00" opacity="0.8">
            <animate attributeName="opacity" values="0.3;0.8;0.3" dur="1s" repeatCount="indefinite"/>
          </circle>
          <circle cx="40" cy="30" r="2.5" fill="#ffff00" opacity="0.8">
            <animate attributeName="opacity" values="0.8;0.3;0.8" dur="1.2s" repeatCount="indefinite"/>
          </circle>
          <circle cx="110" cy="30" r="2.5" fill="#ffff00" opacity="0.8">
            <animate attributeName="opacity" values="0.3;0.8;0.3" dur="1.2s" repeatCount="indefinite"/>
          </circle>
        </svg>
      `;
    }

    function spawnDuck() {
      const container = document.getElementById('duckContainer');
      const duck = document.createElement('div');
      duck.className = 'duck';
      duck.innerHTML = createDuckSVG();
      duck.style.left = Math.random() * 90 + '%';
      duck.style.bottom = '-100px';
      
      container.appendChild(duck);
      
      setTimeout(() => {
        duck.remove();
      }, 4000);
    }

    function showCheerleaderDuck() {
      const overlay = document.getElementById('cheerleaderOverlay');
      const duckEl = document.getElementById('cheerleaderDuck');
      
      duckEl.innerHTML = createCheerleaderDuckSVG();
      overlay.classList.add('active');
      
      // Spawn confetti
      for (let i = 0; i < 30; i++) {
        setTimeout(() => {
          const confetti = document.createElement('div');
          confetti.className = 'confetti';
          const colors = ['#ff1493', '#ffff00', '#00ff00', '#00ffff', '#ff00ff'];
          confetti.style.background = colors[Math.floor(Math.random() * colors.length)];
          confetti.style.left = (Math.random() * 100) + '%';
          confetti.style.top = '20%';
          confetti.style.animationDelay = (Math.random() * 0.3) + 's';
          overlay.appendChild(confetti);
          
          setTimeout(() => confetti.remove(), 1500);
        }, i * 30);
      }
      
      setTimeout(() => {
        overlay.classList.remove('active');
      }, 2000);
    }

    function createCelebrationDucks() {
      const container = document.getElementById('celebrateDucks');
      container.innerHTML = '';
      
      for (let i = 0; i < 3; i++) {
        const duck = document.createElement('div');
        duck.className = 'duck-celebrate';
        duck.innerHTML = createDuckSVG();
        duck.style.left = (20 + i * 30) + '%';
        duck.style.bottom = '10px';
        duck.style.animationDelay = (i * 0.2) + 's';
        container.appendChild(duck);
      }
    }

    function renderLeaderboard(data) {
      const sortedData = [...data].sort((a, b) => b.score - a.score).slice(0, 10);
      
      const startHtml = sortedData.map((entry, index) => `
        <div class="leaderboard-item ${index < 3 ? 'top3' : ''}">
          <span>${index + 1}. ${entry.player_name}</span>
          <span>${entry.score} mata</span>
        </div>
      `).join('');
      
      document.getElementById('startLeaderboard').innerHTML = startHtml || '<div style="text-align: center; color: #888;">Belum ada skor</div>';
      document.getElementById('endLeaderboard').innerHTML = startHtml || '<div style="text-align: center; color: #888;">Belum ada skor</div>';
    }

    function initBoard() {
      gameState.board = Array(ROWS).fill().map(() => Array(COLS).fill(0));
      const boardEl = document.getElementById('gameBoard');
      boardEl.innerHTML = '';
      
      for (let i = 0; i < ROWS * COLS; i++) {
        const cell = document.createElement('div');
        cell.className = 'cell';
        boardEl.appendChild(cell);
      }
    }

    function createPiece() {
      const shapes = [
        [[1,1,1,1]],
        [[1,1],[1,1]],
        [[1,1,1],[0,1,0]],
        [[1,1,1],[1,0,0]],
        [[1,1,1],[0,0,1]],
        [[1,1,0],[0,1,1]],
        [[0,1,1],[1,1,0]]
      ];
      
      const shape = shapes[Math.floor(Math.random() * shapes.length)];
      const color = COLORS[Math.floor(Math.random() * COLORS.length)];
      
      return { shape, color };
    }

    function drawBoard() {
      const cells = document.querySelectorAll('.cell');
      
      for (let row = 0; row < ROWS; row++) {
        for (let col = 0; col < COLS; col++) {
          const index = row * COLS + col;
          const cell = cells[index];
          
          if (gameState.board[row][col]) {
            cell.style.backgroundColor = gameState.board[row][col];
            cell.classList.add('filled');
          } else {
            cell.style.backgroundColor = 'transparent';
            cell.classList.remove('filled');
          }
        }
      }
      
      if (gameState.currentPiece) {
        const { shape, color } = gameState.currentPiece;
        for (let row = 0; row < shape.length; row++) {
          for (let col = 0; col < shape[row].length; col++) {
            if (shape[row][col]) {
              const boardRow = gameState.currentY + row;
              const boardCol = gameState.currentX + col;
              if (boardRow >= 0 && boardRow < ROWS && boardCol >= 0 && boardCol < COLS) {
                const index = boardRow * COLS + boardCol;
                cells[index].style.backgroundColor = color;
              }
            }
          }
        }
      }
    }

    function canMove(piece, x, y) {
      for (let row = 0; row < piece.shape.length; row++) {
        for (let col = 0; col < piece.shape[row].length; col++) {
          if (piece.shape[row][col]) {
            const newX = x + col;
            const newY = y + row;
            
            if (newX < 0 || newX >= COLS || newY >= ROWS) return false;
            if (newY >= 0 && gameState.board[newY][newX]) return false;
          }
        }
      }
      return true;
    }

    function rotatePiece(piece) {
      const rotated = [];
      const rows = piece.shape.length;
      const cols = piece.shape[0].length;
      
      for (let col = 0; col < cols; col++) {
        rotated[col] = [];
        for (let row = rows - 1; row >= 0; row--) {
          rotated[col].push(piece.shape[row][col]);
        }
      }
      
      return { shape: rotated, color: piece.color };
    }

    function mergePiece() {
      const { shape, color } = gameState.currentPiece;
      for (let row = 0; row < shape.length; row++) {
        for (let col = 0; col < shape[row].length; col++) {
          if (shape[row][col]) {
            const boardRow = gameState.currentY + row;
            const boardCol = gameState.currentX + col;
            if (boardRow >= 0) {
              gameState.board[boardRow][boardCol] = color;
            }
          }
        }
      }
      
      checkLines();
    }

    function checkLines() {
      let linesCleared = 0;
      
      for (let row = ROWS - 1; row >= 0; row--) {
        if (gameState.board[row].every(cell => cell !== 0)) {
          gameState.board.splice(row, 1);
          gameState.board.unshift(Array(COLS).fill(0));
          linesCleared++;
          row++;
        }
      }
      
      if (linesCleared > 0) {
        spawnDuck();
        pauseGame();
        showQuestion();
      }
    }

    function showQuestion() {
      const availableQuestions = PERIBAHASA_QUESTIONS.filter((_, index) => 
        !gameState.usedQuestions.has(index)
      );
      
      if (availableQuestions.length === 0) {
        gameState.usedQuestions.clear();
      }
      
      const questionIndex = PERIBAHASA_QUESTIONS.findIndex(q => 
        !gameState.usedQuestions.has(PERIBAHASA_QUESTIONS.indexOf(q)) &&
        availableQuestions.includes(q)
      );
      
      const question = PERIBAHASA_QUESTIONS[questionIndex];
      gameState.usedQuestions.add(questionIndex);
      
      document.getElementById('questionText').textContent = question.q;
      
      // Randomize answers
      const answersWithIndex = question.answers.map((answer, index) => ({
        text: answer,
        isCorrect: index === question.correct
      }));
      
      // Shuffle the answers
      for (let i = answersWithIndex.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [answersWithIndex[i], answersWithIndex[j]] = [answersWithIndex[j], answersWithIndex[i]];
      }
      
      const answersContainer = document.getElementById('answersContainer');
      answersContainer.innerHTML = '';
      
      answersWithIndex.forEach((answer) => {
        const btn = document.createElement('button');
        btn.className = 'answer-btn';
        btn.textContent = answer.text;
        btn.onclick = () => checkAnswer(answer.isCorrect, question.q, answer.text);
        answersContainer.appendChild(btn);
      });
      
      document.getElementById('questionOverlay').classList.add('active');
    }

    function checkAnswer(isCorrect, questionText, selectedAnswer) {
      const buttons = document.querySelectorAll('.answer-btn');
      buttons.forEach((btn) => {
        btn.disabled = true;
        if (btn.textContent === selectedAnswer) {
          if (isCorrect) {
            btn.classList.add('correct');
          } else {
            btn.classList.add('wrong');
          }
        }
      });
      
      if (isCorrect) {
        gameState.score += 10;
        for (let i = 0; i < 3; i++) {
          setTimeout(() => spawnDuck(), i * 300);
        }
        
        // Show cheerleader duck animation
        setTimeout(() => showCheerleaderDuck(), 500);
      }
      
      gameState.answeredQuestions.push({
        question: questionText,
        answer: selectedAnswer,
        correct: isCorrect
      });
      
      updateScore();
      
      setTimeout(() => {
        document.getElementById('questionOverlay').classList.remove('active');
        resumeGame();
      }, 1500);
    }

    function updateScore() {
      document.getElementById('currentScore').textContent = gameState.score;
      document.getElementById('questionsAnswered').textContent = gameState.answeredQuestions.length;
    }

    function updateTimer() {
      const minutes = Math.floor(gameState.timeLeft / 60);
      const seconds = gameState.timeLeft % 60;
      document.getElementById('timer').textContent = 
        `${minutes}:${seconds.toString().padStart(2, '0')}`;
      
      if (gameState.timeLeft <= 0) {
        endGame();
      }
      gameState.timeLeft--;
    }

    function pauseGame() {
      gameState.isPaused = true;
      if (gameState.gameInterval) {
        clearInterval(gameState.gameInterval);
      }
      if (gameState.timerInterval) {
        clearInterval(gameState.timerInterval);
      }
    }

    function resumeGame() {
      gameState.isPaused = false;
      gameState.gameInterval = setInterval(gameLoop, 500);
      gameState.timerInterval = setInterval(updateTimer, 1000);
    }

    function gameLoop() {
      if (gameState.isPaused) return;
      
      if (!gameState.currentPiece) {
        gameState.currentPiece = createPiece();
        gameState.currentX = Math.floor(COLS / 2) - 1;
        gameState.currentY = 0;
        
        if (!canMove(gameState.currentPiece, gameState.currentX, gameState.currentY)) {
          endGame();
          return;
        }
      }
      
      if (canMove(gameState.currentPiece, gameState.currentX, gameState.currentY + 1)) {
        gameState.currentY++;
      } else {
        mergePiece();
        gameState.currentPiece = null;
      }
      
      drawBoard();
    }

    function startGame() {
      const nameInput = document.getElementById('playerName');
      if (!nameInput.value.trim()) {
        nameInput.style.borderColor = '#ff0000';
        setTimeout(() => nameInput.style.borderColor = '#ff00ff', 500);
        return;
      }
      
      gameState.playerName = nameInput.value.trim();
      gameState.score = 0;
      gameState.timeLeft = GAME_DURATION;
      gameState.usedQuestions.clear();
      gameState.answeredQuestions = [];
      gameState.isPaused = false;
      
      document.getElementById('currentPlayer').textContent = gameState.playerName;
      updateScore();
      
      initBoard();
      
      document.getElementById('startScreen').classList.remove('active');
      document.getElementById('gameScreen').classList.add('active');
      
      resumeGame();
      
      document.addEventListener('keydown', handleKeyPress);
    }

    function handleKeyPress(e) {
      if (gameState.isPaused || !gameState.currentPiece) return;
      
      if (e.key === 'ArrowLeft') {
        if (canMove(gameState.currentPiece, gameState.currentX - 1, gameState.currentY)) {
          gameState.currentX--;
          drawBoard();
        }
      } else if (e.key === 'ArrowRight') {
        if (canMove(gameState.currentPiece, gameState.currentX + 1, gameState.currentY)) {
          gameState.currentX++;
          drawBoard();
        }
      } else if (e.key === 'ArrowDown') {
        if (canMove(gameState.currentPiece, gameState.currentX, gameState.currentY + 1)) {
          gameState.currentY++;
          drawBoard();
        }
      } else if (e.key === 'ArrowUp') {
        const rotated = rotatePiece(gameState.currentPiece);
        if (canMove(rotated, gameState.currentX, gameState.currentY)) {
          gameState.currentPiece = rotated;
          drawBoard();
        }
      }
    }

    function toggleMenu() {
      const menuOverlay = document.getElementById('menuOverlay');
      const isActive = menuOverlay.classList.contains('active');
      
      if (!isActive) {
        pauseGame();
        updateAnsweredList();
        menuOverlay.classList.add('active');
      } else {
        menuOverlay.classList.remove('active');
        resumeGame();
      }
    }

    function updateAnsweredList() {
      const listEl = document.getElementById('answeredList');
      
      if (gameState.answeredQuestions.length === 0) {
        listEl.innerHTML = '<div style="text-align: center; color: #888;">Belum ada soalan dijawab</div>';
        return;
      }
      
      listEl.innerHTML = gameState.answeredQuestions.map((item, index) => `
        <div class="answered-item ${item.correct ? 'correct' : 'wrong'}">
          <div style="font-weight: bold;">${index + 1}. ${item.question}</div>
          <div style="margin-top: 5px;">Jawapan: ${item.answer} ${item.correct ? '‚úì' : '‚úó'}</div>
        </div>
      `).join('');
    }

    function exitGame() {
      if (gameState.gameInterval) clearInterval(gameState.gameInterval);
      if (gameState.timerInterval) clearInterval(gameState.timerInterval);
      
      document.getElementById('menuOverlay').classList.remove('active');
      document.getElementById('gameScreen').classList.remove('active');
      document.getElementById('startScreen').classList.add('active');
      
      document.removeEventListener('keydown', handleKeyPress);
    }

    async function endGame() {
      pauseGame();
      
      document.getElementById('gameScreen').classList.remove('active');
      document.getElementById('endScreen').classList.add('active');
      document.getElementById('finalScore').textContent = gameState.score + ' MATA';
      
      const motivationIndex = Math.floor(Math.random() * MOTIVATION_MESSAGES.length);
      document.getElementById('motivationText').textContent = MOTIVATION_MESSAGES[motivationIndex];
      
      createCelebrationDucks();
      
      for (let i = 0; i < 8; i++) {
        setTimeout(() => spawnDuck(), i * 400);
      }
      
      document.removeEventListener('keydown', handleKeyPress);
      
      const result = await window.dataSdk.create({
        player_name: gameState.playerName,
        score: gameState.score,
        timestamp: new Date().toISOString()
      });
      
      if (!result.isOk) {
        console.error("Failed to save score");
      }
    }

    function replayGame() {
      document.getElementById('endScreen').classList.remove('active');
      document.getElementById('startScreen').classList.add('active');
      document.getElementById('playerName').value = gameState.playerName;
    }

    async function onConfigChange(config) {
      const titleElement = document.getElementById('gameTitle');
      const welcomeElement = document.getElementById('welcomeMessage');
      
      titleElement.textContent = config.game_title || defaultConfig.game_title;
      welcomeElement.textContent = config.welcome_message || defaultConfig.welcome_message;
    }

    if (window.elementSdk) {
      window.elementSdk.init({
        defaultConfig,
        onConfigChange,
        mapToCapabilities: (config) => ({
          recolorables: [],
          borderables: [],
          fontEditable: undefined,
          fontSizeable: undefined
        }),
        mapToEditPanelValues: (config) => new Map([
          ["game_title", config.game_title || defaultConfig.game_title],
          ["welcome_message", config.welcome_message || defaultConfig.welcome_message]
        ])
      });
    }

    function addDucksToElements() {
      const duckSVG = createDuckSVG();
      
      document.querySelectorAll('.duck-header').forEach(el => {
        el.innerHTML = duckSVG;
      });
      
      document.querySelectorAll('.duck-corner').forEach(el => {
        el.innerHTML = duckSVG;
      });
      
      document.querySelectorAll('.duck-swim').forEach(el => {
        el.innerHTML = duckSVG;
      });
      
      document.querySelectorAll('.duck-bounce').forEach(el => {
        el.innerHTML = duckSVG;
      });
      
      document.querySelectorAll('.duck-spin').forEach(el => {
        el.innerHTML = duckSVG;
      });
      
      document.querySelectorAll('.duck-float').forEach(el => {
        el.innerHTML = duckSVG;
      });
      
      document.querySelectorAll('.duck-shake').forEach(el => {
        el.innerHTML = duckSVG;
      });
      
      document.querySelectorAll('.duck-pulse').forEach(el => {
        el.innerHTML = duckSVG;
      });
    }

    window.addEventListener('DOMContentLoaded', () => {
      init();
      addDucksToElements();
    });
  </script>
 <script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9a276bf7668326f2',t:'MTc2MzgwMzk2OS4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
